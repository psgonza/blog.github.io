<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>bynario.com</title>
  <meta name="author" content="psgonza">

  <link href="/rss.xml" type="application/rss+xml" rel="alternate"
        title="bynario.com RSS Feed" />



  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">


    <link href="/favicon.png" rel="icon">

  <link href="/theme/css/main.css" media="screen, projection"
        rel="stylesheet" type="text/css">

  <link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="/"><img src="https://dl.dropboxusercontent.com/u/14814182/blog/bynario_logo.gif"></a></h1>
</hgroup></header>
  <nav role="navigation">
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<ul class="main-navigation">
    <li><a href="/">Home</a></li>
    <li><a href="/category/posts.html">Posts</a></li>
    <li><a href="/rss.xml">RSS</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="/2018-05-15-batch-macos-convert-resize-nef-to-jpg.html">NEF batch processing in MacOS (from CLI)</a>
      </h1>
    <p class="meta">
<time datetime="2018-05-15T00:05:15+02:00" pubdate>Tue 15 May 2018</time>    </p>
</header>

  <div class="entry-content"><p>Hi there</p>
<p>In case someone has to scratch the same itch as me (converting and resizing big NEF files to ease the visualization over the network), this is (by far, I'd say) the easiest way to generate (and resize) a jpg file from a big fat Nikon RAW file (NEF):</p>
<div class="highlight"><pre><span></span><span class="nv">psgonza</span><span class="o">/</span><span class="nv">Nikon</span>$ <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> `<span class="nv">ls</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span>.<span class="nv">NEF</span>`<span class="c1">; </span>
<span class="k">do</span> 
<span class="nv">sips</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">format</span> <span class="nv">jpeg</span> <span class="o">-</span><span class="nv">s</span> <span class="nv">formatOptions</span> <span class="mi">50</span> <span class="o">-</span><span class="nv">Z</span> <span class="mi">3000</span> <span class="s2">&quot;</span><span class="s">${i}</span><span class="s2">&quot;</span> <span class="o">--</span><span class="nv">out</span> <span class="s2">&quot;</span><span class="s">jpg/${i%NEF}jpg</span><span class="s2">&quot;</span><span class="c1">; </span>
<span class="nv">done</span>
</pre></div>


<p>Above command will:</p>
<ul>
<li>Go through all the NEF files in current directory   </li>
<li>Generate a jpg from the original nef file    </li>
<li>Set jpg quality at 50%    </li>
<li>Resize the image to max 3000px (either width or height, whatever is bigger) </li>
</ul>
<p>It took <strong>A WHILE</strong> to process all the files (in my case, 1003 pictures), but I'd say it is worthy... I ended up dealing with (aprox) 1MB jpg files, instead of the original 25MB NEF files I had.</p>
<p>I am fairly new to the Mac OS world so I didn't know about <a href="https://ss64.com/osx/sips.html">sips</a> until 30 min ago, although it has been included by default in Mac OS since 2003...</p>
<p>Pretty handy</p></div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="/2018-02-17-psa_minikeepass_and_key_files.html">PSA: MiniKeePass and key files</a>
      </h1>
    <p class="meta">
<time datetime="2018-02-17T00:01:17+02:00" pubdate>Sat 17 February 2018</time>    </p>
</header>

  <div class="entry-content"><p>In case you plan to use MiniKeePass on your iphone with key files (which I guess is highly recommended if you plan to share your kdb via Dropbox/Drive/you_name_it), pay special attention to the last line of their help page:</p>
<div class="highlight"><pre><span></span><span class="nv">Using</span> <span class="nv">Key</span> <span class="nv">Files</span>

<span class="nv">MiniKeePass</span> <span class="nv">can</span> <span class="nv">open</span> <span class="nv">KeePass</span> <span class="mi">1</span>.<span class="nv">x</span><span class="o">/</span><span class="mi">2</span>.<span class="nv">x</span> <span class="nv">files</span> <span class="nv">that</span> <span class="nv">use</span> <span class="nv">a</span> <span class="nv">key</span> <span class="nv">file</span> <span class="nv">instead</span> <span class="nv">of</span> <span class="nv">or</span> <span class="nv">in</span>
<span class="nv">addition</span> <span class="nv">to</span> <span class="nv">a</span> <span class="nv">password</span>.

<span class="nv">Steps</span>:

<span class="nv">Load</span> <span class="nv">your</span> <span class="nv">KeePass</span> <span class="nv">database</span> <span class="nv">and</span> <span class="nv">key</span> <span class="nv">file</span> <span class="nv">in</span> <span class="nv">MiniKeePass</span> <span class="nv">using</span> <span class="nv">iTunes</span>, <span class="nv">Dropbox</span>, <span class="nv">etc</span>.
<span class="nv">Open</span> <span class="nv">your</span> <span class="nv">KeePass</span> <span class="nv">file</span> <span class="nv">in</span> <span class="nv">MiniKeePass</span>
<span class="nv">When</span> <span class="nv">prompted</span> <span class="k">for</span> <span class="nv">your</span> <span class="nv">password</span> <span class="nv">you</span> <span class="nv">can</span> <span class="nv">enter</span> <span class="nv">a</span> <span class="nv">password</span> <span class="nv">and</span><span class="o">/</span><span class="nv">or</span> <span class="nv">select</span> <span class="nv">a</span> <span class="nv">key</span> <span class="nv">file</span>

<span class="nv">Note</span>: <span class="nv">MiniKeePass</span> <span class="nv">will</span> <span class="nv">automatically</span> <span class="nv">select</span> <span class="nv">your</span> <span class="nv">key</span> <span class="nv">file</span> <span class="k">if</span> <span class="nv">it</span> <span class="nv">has</span> <span class="nv">the</span> <span class="nv">same</span>
<span class="nv">filename</span> <span class="nv">as</span> <span class="nv">your</span> <span class="nv">KeePass</span> <span class="nv">file</span> <span class="nv">but</span> <span class="nv">with</span> <span class="nv">a</span> .<span class="nv">key</span> <span class="nv">extension</span>.
</pre></div>


<p>Basically, you have to upload your data base and the key file <strong> with the same name </strong>(ie: MyDB.kdb and MyDB.key) to your_cloud_storage_service_here, and then, open both of them with MiniKeePass. Otherwise, all you will see in the Key-file screen is "None". </p>
<p>I learnt it the hard way and I lost 15 minutes of my life trying to import a key file with a different name than the KeePass database.</p>
<p>The devil is in the detail, as usual.... ;)</p>
<p>///psgonza</p>
<p><a href="https://keepass.info/">KeePass</a> is great, you should totally use. <a href="https://minikeepass.github.io/">MiniKeePass</a> is just fine, does the job too.</p></div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="/2017-12-31-bye-bye-2017_hello-2018.html">Bye bye 2017, hello 2018</a>
      </h1>
    <p class="meta">
<time datetime="2017-12-31T23:59:59+02:00" pubdate>Sun 31 December 2017</time>    </p>
</header>

  <div class="entry-content"><p>We have a coouple of hours left from this 2017... Or maybe you are already in 2018, or half a day away if you are in some places of the US... </p>
<p>Anyways, happy new year!</p>
<p>There will be time to analyze what was good, bad or needs to be improved in the coming days... Meanwhile, enjoy New Years Eve!</p>
<p>\\psgonza</p></div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="/2017-08-25-string-manipulation-exercise-perl-python-awk.html">String manipulation exercise: Perl, Python, Awk</a>
      </h1>
    <p class="meta">
<time datetime="2017-08-25T08:25:00+02:00" pubdate>Fri 25 August 2017</time>    </p>
</header>

  <div class="entry-content"><p>Here comes a small comparation of the performance of Perl, Awk and Python while parsing and splitting lines in a BIG ldif file with thousands or millions of subscriber profiles like <a href="https://raw.githubusercontent.com/psgonza/bynario/master/2017-08-25-string-manipulation_example.ldif">this one</a> (I created this ldif file as an example, just for the sake of clarity)</p>
<p>As in the example, one of the attributes in my ldif files was a huge base64 string (more than 10k bytes long) in a single line, which is not supported by slapadd/slapd (I have checked LDIF rfc and I don't see any mention to the 4096 bytes limitation, so it could be our own implementation, not sure about this), so the idea was to spit this line into 76 characters lines (as per recommendation)... Something like this:</p>
<p>Original line (short version):</p>
<div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Service</span><span class="p">:</span> <span class="n">SSBhbSBoYXBweSB0byBqb2luIHdpdGggeW91IHRvZGF5IGluIHdoYXQgd2lsbCBnbyBkb3duIGluIGhpc3RvcnkgYXMgdGhlIGdyZWF0ZXN0IGRlbW9uc3RyYXRpIGV2ZXJ5IHN0YXRlIGZa</span>
<span class="p">...</span>
</pre></div>


<p>Replaced by:</p>
<div class="highlight"><pre><span></span><span class="p">...</span>
<span class="n">Service</span><span class="p">:</span> <span class="n">SSBhbSBoYXBweSB0byBqb2luIHdpdGggeW91IHRvZGF5IGluIHdoYXQgd2lsbCBnbyBkb3</span>
 <span class="n">duIGluIGhpc3RvcnkgYXMgdGhlIGdyZWF0ZXN0IGRlbW9uc3RyYXRpIGV2ZXJ5IHN0YXRlIGZa</span>
<span class="p">...</span>
</pre></div>


<p>(Notice the blank at the beginning of the second line)</p>
<p>My first approach was to use Python standard module <em>textwrap</em>:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ldiffile</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Input file missing... Exit&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>


<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ldiffile</span><span class="p">,</span> <span class="s2">&quot;rU&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Service:&quot;</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">76</span><span class="p">,</span><span class="n">subsequent_indent</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>


<p>It was really simple and produced the expected result, but it was ridiculously slow. <strong>RIDICULOUSLY</strong>. Really, difficult to believe...</p>
<p>So I decided to do something similar, but this time I dealt with the line split myself:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ldiffile</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Input file missing... Exit&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fixlen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="c1">#First line, no blank at the beginning of the line</span>
    <span class="k">print</span> <span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span>
    <span class="c1">#now, starting with blank</span>
    <span class="k">while</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">print</span> <span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">s</span><span class="p">[:</span><span class="n">n</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">n</span><span class="p">:]</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ldiffile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Service:&quot;</span><span class="p">):</span>
            <span class="n">fixlen</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">76</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div>


<p>The results I got were way better, but still, it took more than I expected... Time to give it a try with other tools: AWK and Perl</p>
<p>Basically I "translated" the python script to awk and perl, almost to the letter...</p>
<p>Perl version:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/perl</span>
<span class="k">my</span> <span class="nv">$noident</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=</span> <span class="o">&lt;&gt;</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">chomp</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span> <span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /^Service:.*/</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="nb">unpack</span><span class="p">(</span><span class="s">&quot;(A76)*&quot;</span><span class="p">,</span><span class="nv">$line</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$noindent</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">print</span> <span class="s">&quot;$_\n&quot;</span><span class="p">;</span>
            <span class="nv">$noindent</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span> <span class="k">print</span> <span class="s">&quot; $_\n&quot;</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="nv">$noindent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">print</span> <span class="s">&quot;$line\n&quot;</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Awk version:</p>
<div class="highlight"><pre><span></span><span class="nv">awk</span> <span class="s1">&#39;</span>
  <span class="nv">BEGIN</span> {
    <span class="nv">indent</span> <span class="o">=</span> <span class="mi">0</span><span class="c1">;</span>
    <span class="nv">i</span><span class="o">=</span><span class="mi">0</span><span class="c1">;</span>
  }
  {
  <span class="k">if</span> <span class="ss">(</span> <span class="mh">$0</span> <span class="o">~</span> <span class="o">/^</span><span class="nv">Service</span>:.<span class="o">*/</span><span class="ss">)</span> {
    <span class="k">while</span><span class="ss">(</span><span class="nv">i</span><span class="o">&lt;=</span><span class="nv">length</span><span class="ss">(</span><span class="mh">$0</span><span class="ss">))</span>{
        <span class="k">if</span> <span class="ss">(</span> $<span class="nv">indent</span> <span class="o">==</span> <span class="mi">0</span> <span class="ss">)</span> { <span class="nv">printf</span> <span class="s2">&quot;</span><span class="s">%s</span><span class="se">\n</span><span class="s2">&quot;</span>, <span class="nv">substr</span><span class="ss">(</span><span class="mh">$0</span>,<span class="nv">i</span>,<span class="mi">76</span><span class="ss">)</span><span class="c1">;i+=76;indent=1; }</span>
        <span class="k">else</span> { <span class="nv">printf</span> <span class="s2">&quot;</span><span class="s"> %s</span><span class="se">\n</span><span class="s2">&quot;</span>, <span class="nv">substr</span><span class="ss">(</span><span class="mh">$0</span>,<span class="nv">i</span>,<span class="mi">76</span><span class="ss">)</span><span class="c1">;i+=76;}</span>
   }
   }
   <span class="k">else</span> {
        <span class="nv">print</span> <span class="mh">$0</span><span class="c1">;</span>
   }
  }<span class="s1">&#39;</span><span class="s"> $1</span>
</pre></div>


<p>I "faked" several input files with thousands of lines (discarding the output), executed all the scripts in Cygwin64, and then checked the time it took.. Something like this:</p>
<div class="highlight"><pre><span></span><span class="n">time</span> <span class="n">python3</span> <span class="n">textwrap</span><span class="p">.</span><span class="n">py</span> <span class="n">XXXX</span><span class="p">.</span><span class="n">ldif</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span>
<span class="n">time</span> <span class="n">python3</span> <span class="n">pythonv1</span><span class="p">.</span><span class="n">py</span> <span class="n">XXXX</span><span class="p">.</span><span class="n">ldif</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span>
<span class="n">time</span> <span class="n">python3</span> <span class="n">pythonv2</span><span class="p">.</span><span class="n">py</span> <span class="n">XXXX</span><span class="p">.</span><span class="n">ldif</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span>
<span class="n">time</span> <span class="n">perl</span> <span class="n">split</span><span class="p">.</span><span class="n">pl</span>  <span class="n">XXXX</span><span class="p">.</span><span class="n">ldif</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span>
<span class="n">time</span> <span class="p">.</span><span class="o">/</span><span class="n">split</span><span class="p">.</span><span class="n">awk</span> <span class="n">XXXX</span><span class="p">.</span><span class="n">ldif</span> <span class="o">&amp;&gt;</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="k">null</span>
</pre></div>


<p>All of them generated the exact same output (except the textwrap version that handles the first line in a different way), but the execution time differs:</p>
<p>{% img center https://raw.githubusercontent.com/psgonza/bynario/master/results_table.JPG 'results_table' %}</p>
<p>It is easier to see in a chart:</p>
<p>{% img center https://raw.githubusercontent.com/psgonza/bynario/master/results_chart.JPG 'results_chart' %}</p>
<p>My takeaways after this small exercise:</p>
<ul>
<li>Awk rocks. </li>
<li>Perl's black magic is almost as fast as awk. </li>
<li>Python is not really fast at file processing. Yes, there are ways to improve this, by splitting in chunks, parallel processing and whatnot... But it takes more than 15 lines. </li>
<li>Stay away of textwrap module for heavy usage. </li>
</ul>
<p>It was fun... Bye!</p>
<p>PS: As you can see in the results, there is a "Python v2" column which produced better results... It is a modification of the original script where I used a comprehension list approach:</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ldiffile</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Input file missing... Exit&quot;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fixlen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="n">first</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="o">+</span><span class="n">i</span><span class="p">:</span><span class="n">n</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tmp</span><span class="p">:</span>
        <span class="c1">#First line, no blank at the beginning of the line</span>
        <span class="k">if</span> <span class="n">first</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">first</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#now, starting with blank</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ldiffile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;Service:&quot;</span><span class="p">):</span>
            <span class="n">fixlen</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="mi">76</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</pre></div></div>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="/2017-06-05-issues-running-gpg-in-a-container.html">Issues running gpg in a container</a>
      </h1>
    <p class="meta">
<time datetime="2017-06-05T00:01:17+02:00" pubdate>Mon 05 June 2017</time>    </p>
</header>

  <div class="entry-content"><p>In case it helps...</p>
<p>I am giving a try to <a href="https://github.com/pahaz/docker-compose-django-postgresql-redis-example">this docker componse example</a>, and for some strange reason, docker was stuck in this block of code in the Dockerfile for one of the components:</p>
<div class="highlight"><pre><span></span># <span class="nv">grab</span> <span class="nv">gosu</span> <span class="k">for</span> <span class="nv">easy</span> <span class="nv">step</span><span class="o">-</span><span class="nv">down</span> <span class="nv">from</span> <span class="nv">root</span>
<span class="nv">ENV</span> <span class="nv">GOSU_VERSION</span> <span class="mi">1</span>.<span class="mi">7</span>
<span class="nv">RUN</span> <span class="nv">set</span> <span class="o">-</span><span class="nv">x</span> \
        <span class="o">&amp;&amp;</span> <span class="nv">apt</span><span class="o">-</span><span class="nv">get</span> <span class="nv">update</span> <span class="o">&amp;&amp;</span> <span class="nv">apt</span><span class="o">-</span><span class="nv">get</span> <span class="nv">install</span> <span class="o">-</span><span class="nv">y</span> <span class="o">--</span><span class="nv">no</span><span class="o">-</span><span class="nv">install</span><span class="o">-</span><span class="nv">recommends</span> <span class="nv">ca</span><span class="o">-</span><span class="nv">certificates</span> <span class="nv">wget</span> <span class="o">&amp;&amp;</span> <span class="nv">rm</span> <span class="o">-</span><span class="nv">rf</span> <span class="o">/</span><span class="nv">var</span><span class="o">/</span><span class="nv">lib</span><span class="o">/</span><span class="nv">apt</span><span class="o">/</span><span class="nv">lists</span><span class="cm">/* \</span>
<span class="cm">        &amp;&amp; wget -O /usr/local/bin/gosu &quot;https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$(dpkg --print-architecture)&quot; \</span>
<span class="cm">        &amp;&amp; wget -O /usr/local/bin/gosu.asc &quot;https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$(dpkg --print-architecture).asc&quot; \</span>
<span class="cm">        &amp;&amp; export GNUPGHOME=&quot;$(mktemp -d)&quot; \</span>
<span class="cm">        &amp;&amp; gpg --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \</span>
<span class="cm">        &amp;&amp; gpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu \</span>
<span class="cm">        &amp;&amp; rm -r &quot;$GNUPGHOME&quot; /usr/local/bin/gosu.asc \</span>
<span class="cm">        &amp;&amp; chmod +x /usr/local/bin/gosu \</span>
<span class="cm">        &amp;&amp; gosu nobody true</span>
</pre></div>


<p>Specifically, in this line:</p>
<div class="highlight"><pre><span></span><span class="n">gpg</span> <span class="c1">--keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 </span>
</pre></div>


<p>It is a really simple command... I could ping the keyserver, I checked the website and everything looked ok, but it wasn't working, neither in the host machine or inside a container... The response was the same: timeout while getting the keys</p>
<p>So... Here comes netstat to the rescue:</p>
<div class="highlight"><pre><span></span><span class="o">#</span> <span class="n">netstat</span> <span class="o">-</span><span class="n">natop</span> <span class="o">|</span> <span class="n">grep</span> <span class="n">gpg</span>
<span class="n">tcp</span>        <span class="mi">0</span>      <span class="mi">1</span> <span class="mi">192</span><span class="p">.</span><span class="mi">168</span><span class="p">.</span><span class="mi">1</span><span class="p">.</span><span class="mi">10</span><span class="p">:</span><span class="mi">34340</span>      <span class="mi">104</span><span class="p">.</span><span class="mi">236</span><span class="p">.</span><span class="mi">209</span><span class="p">.</span><span class="mi">43</span><span class="p">:</span><span class="mi">11371</span>    <span class="n">SYN_SENT</span>    <span class="mi">8653</span><span class="o">/</span><span class="n">gpg2keys_hkp</span>    <span class="k">on</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">10</span><span class="o">/</span><span class="mi">3</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
</pre></div>


<p>SYN_SENT? So it was trying to stablish the connection, but there wasn't any response from the remote host... <strong><em>In that port</em></strong></p>
<p>It turns out I recently upgraded my internet connection, and the new router allows you to customize the firewall security levels (you know, low, medium, high and paranoid... yeah, I am using the latter). I noticed that port 11371 was not defined in as a "known service", so I wasn't able to reach it from within my home network.  </p>
<p>As soon as I allowed the connection to that port:</p>
<div class="highlight"><pre><span></span><span class="err">#</span><span class="w"> </span><span class="n">gpg</span><span class="w"> </span><span class="c1">--keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4</span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">solicitando</span><span class="w"> </span><span class="n">clave</span><span class="w"> </span><span class="n">BF357DD4</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">hkp</span><span class="w"> </span><span class="n">servidor</span><span class="w"> </span><span class="n">ha</span><span class="p">.</span><span class="n">pool</span><span class="p">.</span><span class="n">sks</span><span class="o">-</span><span class="n">keyservers</span><span class="p">.</span><span class="n">net</span><span class="w"></span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">root</span><span class="o">/</span><span class="p">.</span><span class="n">gnupg</span><span class="o">/</span><span class="n">trustdb</span><span class="p">.</span><span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="n">ha</span><span class="w"> </span><span class="n">creado</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">datos</span><span class="w"> </span><span class="n">de</span><span class="w"> </span><span class="n">confianza</span><span class="w"></span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">clave</span><span class="w"> </span><span class="nl">BF357DD4</span><span class="p">:</span><span class="w"> </span><span class="n">clave</span><span class="w"> </span><span class="n">pública</span><span class="w"> </span><span class="ss">&quot;Tianon Gravi &lt;tianon@tianon.xyz&gt;&quot;</span><span class="w"> </span><span class="n">importada</span><span class="w"></span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="k">no</span><span class="w"> </span><span class="n">se</span><span class="w"> </span><span class="n">encuentran</span><span class="w"> </span><span class="n">claves</span><span class="w"> </span><span class="n">absolutamente</span><span class="w"> </span><span class="n">fiables</span><span class="w"></span>
<span class="nl">gpg</span><span class="p">:</span><span class="w"> </span><span class="n">Cantidad</span><span class="w"> </span><span class="n">total</span><span class="w"> </span><span class="nl">procesada</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="nl">gpg</span><span class="p">:</span><span class="w">               </span><span class="nl">importadas</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="p">(</span><span class="nl">RSA</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
</pre></div>


<p>So make sure all your ip flows are open, even for such a small thing as this one...</p>
<p>Take care out there!</p></div>
  		</article>
<div class="pagination">
    <a class="prev" href="/index2.html">&larr; Older</a>

  <br />
</div></div>
<aside class="sidebar">
  <section>
	  <img src="https://dl.dropboxusercontent.com/u/14814182/blog/roundPic.gif" alt="" width=""/> 
  </section>
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="/2018-05-15-batch-macos-convert-resize-nef-to-jpg.html">NEF batch processing in MacOS (from CLI)</a>
      </li>
      <li class="post">
          <a href="/2018-02-17-psa_minikeepass_and_key_files.html">PSA: MiniKeePass and key files</a>
      </li>
      <li class="post">
          <a href="/2017-12-31-bye-bye-2017_hello-2018.html">Bye bye 2017, hello 2018</a>
      </li>
      <li class="post">
          <a href="/2017-08-25-string-manipulation-exercise-perl-python-awk.html">String manipulation exercise: Perl, Python, Awk</a>
      </li>
      <li class="post">
          <a href="/2017-06-05-issues-running-gpg-in-a-container.html">Issues running gpg in a container</a>
      </li>
    </ul>
  </section>

  <section>
  <h1>Tags</h1>
    <a href="/tag/pelican.html">pelican</a>,    <a href="/tag/google.html">google</a>,    <a href="/tag/data-science.html">data science</a>,    <a href="/tag/telegram.html">telegram</a>,    <a href="/tag/coding.html">coding</a>,    <a href="/tag/blogging.html">blogging</a>,    <a href="/tag/books.html">books</a>,    <a href="/tag/linux.html">linux</a>,    <a href="/tag/images.html">images</a>,    <a href="/tag/technology.html">technology</a>,    <a href="/tag/bynario.html">bynario</a>,    <a href="/tag/spotify.html">spotify</a>,    <a href="/tag/git.html">Git</a>,    <a href="/tag/networking.html">networking</a>,    <a href="/tag/ads.html">ads</a>,    <a href="/tag/quickthoughts.html">quickthoughts</a>,    <a href="/tag/spam.html">spam</a>,    <a href="/tag/tv.html">tv</a>,    <a href="/tag/octopress.html">octopress</a>,    <a href="/tag/psgonza.html">psgonza</a>,    <a href="/tag/synology.html">synology</a>,    <a href="/tag/perl.html">perl</a>,    <a href="/tag/nas.html">nas</a>,    <a href="/tag/internet.html">internet</a>,    <a href="/tag/interview.html">interview</a>,    <a href="/tag/2014.html">2014</a>,    <a href="/tag/2017.html">2017</a>,    <a href="/tag/2016.html">2016</a>,    <a href="/tag/iptables.html">iptables</a>,    <a href="/tag/kubernetes.html">kubernetes</a>,    <a href="/tag/python.html">python</a>,    <a href="/tag/ntp.html">ntp</a>,    <a href="/tag/2015.html">2015</a>,    <a href="/tag/keepass.html">keepass</a>,    <a href="/tag/photos.html">photos</a>,    <a href="/tag/ssmtp.html">ssmtp</a>,    <a href="/tag/awk.html">awk</a>,    <a href="/tag/cygwin.html">cygwin</a>,    <a href="/tag/meetups.html">meetups</a>,    <a href="/tag/scripts.html">scripts</a>,    <a href="/tag/ipython.html">ipython</a>,    <a href="/tag/monitoring.html">monitoring</a>,    <a href="/tag/security.html">security</a>,    <a href="/tag/bash.html">bash</a>,    <a href="/tag/rss.html">rss</a>,    <a href="/tag/macos.html">macos</a>,    <a href="/tag/tips.html">tips</a>,    <a href="/tag/geotagging.html">geotagging</a>,    <a href="/tag/ssl.html">ssl</a>,    <a href="/tag/windows.html">windows</a>,    <a href="/tag/blogs.html">blogs</a>,    <a href="/tag/privacy.html">privacy</a>,    <a href="/tag/programming.html">programming</a>,    <a href="/tag/cli.html">cli</a>,    <a href="/tag/podcasts.html">podcasts</a>,    <a href="/tag/ansible.html">ansible</a>,    <a href="/tag/opinion.html">opinion</a>,    <a href="/tag/docker.html">docker</a>,    <a href="/tag/note2self.html">note2self</a>,    <a href="/tag/scripting.html">scripting</a>  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <p><a href="https://github.com/psgonza">@psgonza</a></p>
    </ul>
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = '/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'psgonza',
              count: 5,
              skip_forks: false,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="/theme/js/github.js" type="text/javascript"> </script>
  </section>

    <section>
        <h1>Social</h1>
        <ul>
            <li><a href="/rss.xml" type="application/rss+xml" rel="alternate">RSS</a></li>
            <li><a href="#" target="_blank">You can add links in your config file</a></li>
            <li><a href="#" target="_blank">Another social link</a></li>
        </ul>
    </section>
    <section>
        <h1>Blogroll</h1>
        <ul>
            <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
            <li><a href="http://python.org/" target="_blank">Python.org</a></li>
            <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
            <li><a href="#" target="_blank">You can modify those links in your config file</a></li>
        </ul>
    </section>

<section>
   <h1>Tweeter</h1>
    <p>Follow <a href="http://twitter.com/psgonza">@psgonza</a></p>
</section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
    Copyright &copy;  2011&ndash;2018  psgonza &mdash;
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
  <script src="/theme/js/modernizr-2.0.js"></script>
  <script src="/theme/js/ender.js"></script>
  <script src="/theme/js/octopress.js" type="text/javascript"></script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-90925-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-90925-1');
    ga('send', 'pageview');
</script>
  <script type="text/javascript">
    var disqus_shortname = 'bynario';
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = "//" + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
  </script>
</body>
</html>